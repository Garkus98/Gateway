- [Главная (LUA)](/lua_doc/intro.md)
- [Редактор скриптов и отладка](/lua_doc/scriptEditDebug.md#Редактор-скриптов-и-отладка)
## Запуск скриптов
В зависимости от задач, выполняемых той или иной автоматизацией, доступны несколько вариантов запуска скриптов:
1. [скрипт инициализации](/lua_doc/scriptRunMethods.md#скрипт-инициализации)
2. [при изменении состояния устройства](/lua_doc/scriptRunMethods.md#запуск-скрипта-при-изменении-состояния-устройства)
3. [по событию изменения объекта](scriptRunMethods.md#запуск-скрипта-по-событию-изменения-объекта) <!--	#ToDo - в документации вендора данный пункт ссылается на несуществующий раздел? -->
4. [запуск из другого скрипта](scriptRunMethods.md#запуск-lua-скрипта-из-другого-скрипта)
5. [с помощью  http api](scriptRunMethods.md#запуск-скрипта-с-помощью-http-api)
6. [периодический запуск (планировщик)](scriptRunMethods.md#периодический-запуск-скриптов-таймеры)
7. по подписке mqtt (в разработке).

### Скрипт инициализации
При запуске системы выполняется скрипт инициализации `init.lua`, если он есть. Перед началом работы со скриптами, рекомендуется проверить его наличие рядом со всеми остальными скриптами `*.lua`. Если файла нет, то его нужно [создать](/lua_doc/scriptEditDebug.md).  В нем полезно инициализировать переменные для работы с устройством, а также выполнить какие либо действия. [Например:](/lua_doc/examples.md#скрипт-инициализации)
```lua
-- init.lua --
-- Уведомление в Telegram о старте шлюза --
telegram.settoken("51778***5:AAG0bvK***")
telegram.setchat("-3348***")
telegram.send("SLS загружен!!!")
```

### Запуск скрипта при изменении состояния устройства
Скрипт можно запускать как одно из правил [SimpleBind](/simplebind_rus.md).

Синтаксис: `scriptname.lua[,Param]`

Например, так может выглядеть запись SB Rule для датчика открытия ![](/img/luaSBRule.png)
- `mainDoorOnLight.lua` - имя запускаемого скрипта
- `Param` - необязательный параметр, через который в скрипт можно передать необходимые аргументы. Принимается он в скрипте через Событие `Event.Param`
<!--	#ToDo - добавить ссылку на описание событий -->
Аргументов может быть несколько. В данном примере передается 3 аргумента, разделенные символом `:`: целевое устройство, которым должен управлять датчик по сработке; контролируемый статус; задержка управляющего действия. Если аргументы не прописывать, то при изменении условий, придется менять эти значения в теле скрипта.
<!--	#ToDo - добавить пример кода -->

### Запуск скрипта по событию изменения объекта
Синтаксис: `obj.onChange('objName', 'script.lua')`
- `objName` - имя контролируемого объекта
- `script.lua` - имя скрипта, вызываемого при возникновении события

[Например](/lua_doc/examples.md#Включение-режима-сопряжения-по-нажатию-на-кнопку-шлюза), можно вызвать скрипт по событию нажатия аппаратной кнопки шлюза. Реагировать можно на объекты `io.input0.*`. Включим "режим сопряжения" по нажатию на кнопку:
1. в `init.lua` добавить код: `obj.onChange("io.input0.value", "btn_sw1.lua")`
2. создать `btn_sw1.lua` с кодом: `zigbee.join(255, "0x0000")`
<!--	#ToDo - добавить ссылку на описание join  -->
 
### Запуск LUA скрипта из другого скрипта

Синтаксис: `dofile("/int/test.lua")`

### Запуск скрипта с помощью HTTP API

Скрипт SLS можно вызвать из внешней системы используя [HTTP API](/http_api_rus.md):
`/api/scripts?action=evalFile&path=/test.lua`

### Периодический запуск скриптов из планировщика
Шлюз может запускать скрипты с определенной периодичностью. Можно установить таймер запуска к любому скрипту, а так же отменить его. Дискретность таймеров 1 секунда, для cron - 1 минута.

Типы таймеров:
- Периодический. Выполняется каждые `X` секунд. `Event.Type = 5`
  - Синтаксис: `scripts.setTimer("script", t[, Param])`
- Однократный.  Выполняется однократно в UNIX время. `Event.Type = 4`
  - Синтаксис: `scripts.setTimer("script", os.time() + t[, Param])`
- Cron. `Event.Type = 6`. Добавлен в версии прошивки от 2022.04.24d11
  - Синтаксис как у [UNIX cron](https://ru.wikipedia.org/wiki/Cron) 
- где:
  - `script` - имя файла скрипта, без расширения `lua`
  - `t` - уставка времени в сек. Для сброса таймера: `t = 0`
  - `Param` - параметры передаваемые в скрипт

Примеры:

Запуск скрипта каждые 60 секунд:
```lua
scripts.setTimer("getMoney", 60, "$")
```
Запуск скрипта через 5 минут, однократно:
```lua
scripts.setTimer("giveMoney", os.time() + 300)
```
Запуск скрипта каждый день в 01:05:
```lua
scripts.setTimer("earnMoney", "5 1 * * *")
```
Сброс таймера для скрипта OneMinTimer.lua:
```lua
scripts.setTimer("OneMinTimer", 0)
```
Если все 4 примера выполнить подряд для одного скрипта, то настройка применяется из последней команды. В нашем случае таймер будет отключен. 

Например, скрипт привязан к датчику движения и при каждой сработке настраивает однократный таймер запуска исполняющего скрипта. При этом, если скрипт успевает запуститься несколько раз до сработки таймера, то уставка времени будет из последней итерации. 

:warning: **Внимание, скрипты OneMinTimer.lua и OneSecTimer.lua более не запускаются автоматически!!!**