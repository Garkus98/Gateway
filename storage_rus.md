# Хранилище
Шлюз использует хранилище для хранения конфигов, скриптов, звуков и прочих файлов. Может использовать как внутренняя флеш-память так и внешняя на SD-картах. Записывать такеж можно через сценарии, [пример](https://github.com/slsys/Gateway/blob/master/samples_rus.md#сохранение-значений-в-json-через-lua).  

## Структура
Хранилище использует префиксы для обозначения источника данных.
* /int - для внутренней файловой системы, его использование не обязательно
* /sd  - для SD-карты

## Файловые системы
Поддерживается несколько файловых систем для хранилища:
* FAT - классическая файловая система
* LFS - надежная файловая система для микроконтроллеров, не повреждается при неожиданных отключениях питания (доступна с версии 2022.03.29d4)

Для выбора файловой системы используется разметка указанная в файле разделов при прошивке устройства.

Для перехода на другую файловую систему необходимо сделать бэкап всех файлов и перепрошить устройство с нужным файлом разделов. При этом хранилище будет отформатированно.

## HTTP API
Отображение списка файлов в директории */*
```http
GET /api/storage?path=/
```

Чтение содержимого файлв */sd/test.lua*
```http
GET /api/storage?path=/sd/test.lua
```

Запись в файл
```http
POST /api/storage?path=/test.lua&plain=XXX
```

Удаление файла
```http
DELETE /api/storage?path=/test.lua
```

Управление SD накопителем
```http
GET /api/storage/sd?action=mount 
GET /api/storage/sd?action=umount 
```

Информация о хранилище
```http
GET /api/storage/info
```

Переименование файлов
```http
GET /api/storage/rename?old=/file1.lua&new=/file2.lua
```

Создать директорию
```http
GET /api/storage/mkdir?path=/int/mydir
```

Удалить директорию
```http
GET /api/storage/rmdir?path=/int/mydir
```

## Скрипты Lua
Примонтировать SD-карту, можно добавить в *init.lua*:
```lua
os.mountSD(true)
```
## Проверка наличия файла, возвращает true/false
```lua
os.fileExists(fileName)
```
## Удаления файла
```lua
 os.fileRemove(fileName)
```
 ## Переименования файла
 ```lua
os.fileRename(old, new)
```
